<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Data binding and forms - React-MVx</title>
    <meta name="description" content="MVVM Architecture Framework for React" />
    <meta name="author" content="Vlad Balin">
    <meta charset="UTF-8">
    <link rel="icon" href="../themes/daux/img/favicon-navy.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../themes/daux/css/theme-navy.min.css' rel='stylesheet' type='text/css'>
            <!-- Tipue Search -->
        <link href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="">
    
<header class="Navbar hidden-print">
    <a class="Navbar__brand" href="../index.html">React-MVx</a>

    <div class="Search">
        <svg class="Search__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 451"><path d="M447.05 428l-109.6-109.6c29.4-33.8 47.2-77.9 47.2-126.1C384.65 86.2 298.35 0 192.35 0 86.25 0 .05 86.3.05 192.3s86.3 192.3 192.3 192.3c48.2 0 92.3-17.8 126.1-47.2L428.05 447c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4c5.2-5.2 5.2-13.8 0-19zM26.95 192.3c0-91.2 74.2-165.3 165.3-165.3 91.2 0 165.3 74.2 165.3 165.3s-74.1 165.4-165.3 165.4c-91.1 0-165.3-74.2-165.3-165.4z"/></svg>
        <input type="search" id="tipue_search_input" class="Search__field" placeholder="Search..." autocomplete="on" results=25 autosave=text_search>
    </div>
</header>
<div class="Columns content">
    <aside class="Columns__left Collapsible">
        <div class="Collapsible__container">
            <button type="button" class="Button Collapsible__trigger">
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
            </button>
        </div>

        <div class="Collapsible__content">
            <!-- Navigation -->
            <ul class='Nav'><li class='Nav__item '><a href="../Getting_Started.html">Getting Started</a></li><li class='Nav__item Nav__item--open has-children'><a href="../Guides/Data_binding_and_forms.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Guides</a><ul class='Nav'><li class='Nav__item Nav__item--active'><a href="../Guides/Data_binding_and_forms.html">Data binding and forms</a></li><li class='Nav__item '><a href="../Guides/Input_Validation.html">Input Validation</a></li><li class='Nav__item '><a href="../Guides/Editable_Lists.html">Editable Lists</a></li><li class='Nav__item '><a href="../Guides/Paging.html">Paging</a></li><li class='Nav__item '><a href="../Guides/id-references_and_stores.html">id-references and stores</a></li><li class='Nav__item '><a href="../Guides/Layered_application_state.html">Layered application state</a></li></ul></li><li class='Nav__item '><a href="../Overview.html">Overview</a></li><li class='Nav__item  has-children'><a href="../Component/Overview.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Component</a><ul class='Nav'><li class='Nav__item '><a href="../Component/Overview.html">Overview</a></li><li class='Nav__item '><a href="../Component/props.html">props</a></li><li class='Nav__item '><a href="../Component/state.html">state</a></li><li class='Nav__item '><a href="../Component/store.html">store</a></li><li class='Nav__item '><a href="../Component/context.html">context</a></li><li class='Nav__item '><a href="../Component/Other_members.html">Other members</a></li></ul></li><li class='Nav__item  has-children'><a href="../Link/Overview.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Link</a><ul class='Nav'><li class='Nav__item '><a href="../Link/Overview.html">Overview</a></li><li class='Nav__item '><a href="../Link/Link_structure.html">Link structure</a></li><li class='Nav__item '><a href="../Link/Create_the_link.html">Create the link</a></li><li class='Nav__item '><a href="../Link/Link_transformations.html">Link transformations</a></li><li class='Nav__item '><a href="../Link/Links_to_objects_and_arrays.html">Links to objects and arrays</a></li></ul></li><li class='Nav__item '><a href="../Data-bound_controls.html">Data-bound controls</a></li><li class='Nav__item '><a href="../Examples.html">Examples</a></li></ul>

            <div class="Links">
                                    <hr/>
                                            <a href="https://github.com/Volicon/React-MVx/issues" target="_blank">Help/Support/Bugs</a>
                        <br />
                                            <a href="http://volicon.com" target="_blank">Made by Volicon (a Verizon company)</a>
                        <br />
                                    
                                    <div class="CodeToggler">
                        <hr/>
                                                    <a class="CodeToggler__button CodeToggler__button--main" href="#">Show Code Blocks Inline</a><br>
                                            </div>
                
                                    <hr/>
                    <div class="Twitter">
                                                    <iframe allowtransparency="true" frameborder="0" scrolling="no" style="width:162px; height:20px;" src="https://platform.twitter.com/widgets/follow_button.html?screen_name=gaperton&amp;show_count=false"></iframe>
                            <br />
                            <br />
                                            </div>
                            </div>
        </div>
    </aside>
    <div class="Columns__right ">
        <div class="Columns__right__content">
            <div class="doc_content">
                <article class="Page">

    <div class="Page__header">
        <h1>Data binding and forms</h1>
                        <span style="float: right; font-size: 10px; color: gray;">
            <a href="https://github.com/Volicon/React-MVx/blob/develop/docs/01_Guides/01_Data_binding_and_forms.md" target="_blank">Edit on GitHub</a>
        </span>
            </div>


    <div class="s-content">
        <p>In this tutorial we will learn the state management and two-way data binding basics on the example of the simple user info editing form.</p>
<p><img src="./form.png" alt="form" /></p>
<p>Our form will be the simple stateful component holding the state of the form in its local state, and for the purpose of the illustration storing its state in the browser's localStorage.</p>
<h1 id="page_Defining+the+stateful+component">Defining the stateful component</h1>
<p>React-MVx extends React namespace and must be used instead of React. The most important class it exports is the modified <code>Component</code>.</p>
<p>The general definition of the stateful component looks like this:</p>
<pre><code class="language-javascript">import React, { define } from 'react-mvx'
import ReactDOM from 'react-dom'

@define class Application extends React.Component {
    static state = {
        /* state attributes definition */
    };

    render(){
        return (
            /* jsx */
        );
    }
}

ReactDOM.render( &lt;Application/&gt;, document.getElementById( 'react-application' ) );
</code></pre>
<p>There are few differences to raw React so far:</p>
<ul>
<li>Component definitions (as all React-MVx definitions) must be preceded with the <code>@define</code> decorator.</li>
<li>The state is not <em>assigned</em> in the constructor, but <em>declaratively defined</em> in class definition.</li>
</ul>
<h1 id="page_Declaring+the+state">Declaring the state</h1>
<p>In the simplest case like ours when the state is flat and consists of primitive types, the state definition looks like the plain object. We list state attributes accompanied with their default values.</p>
<pre><code class="language-javascript">    static state = {
        name : '',
        email : '',
        isActive : true
    };
</code></pre>
<p>This declaration will lead to an automatic creation of the observable <code>component.state</code> object of the similar shape when the <code>Application</code> component will be mounted. No need to initialize the state in the constructor.</p>
<p>No need for <code>component.setState()</code> either; plain assignments to the <code>component.state</code> members will be detected and will lead to the component's render. Which is cute, but we won't need any explicit state modifications in this example. Because we have two-way data binding.</p>
<h1 id="page_Adding+the+form%27s+markup">Adding the form's markup</h1>
<p>Now it's the time to create the markup for our form using the standard React's <a href="https://facebook.github.io/react/docs/forms.html#controlled-components" class="external">&quot;controlled components&quot;</a>. Controlled components do not have their own local state; it's mapped to some external state container.</p>
<p>In React-MVx this mapping is done with <em>links</em>. Think of <a href="../Link/Overview.html">link</a> in this example as an object-reference to the state's attribute. <code>link.props</code> return the <code>value</code>/<code>onChange</code> props pair which is expected by standard <em>controlled form components</em>.</p>
<pre><code class="language-javascript">    render(){
        // Link the state...
        const { name, email, isActive } = this.linkAll();

        return (
            &lt;form&gt;
                &lt;label&gt;
                    Name: &lt;input type=&quot;text&quot; { ...name.props }/&gt;
                &lt;/label&gt;

                &lt;label&gt;
                    Email: &lt;input type=&quot;text&quot; { ...email.props }/&gt;
                &lt;/label&gt;

                &lt;label&gt;
                    Is active: &lt;input type=&quot;checkbox&quot; { ...isActive.props }/&gt;
                &lt;/label&gt;
            &lt;/form&gt;
        );
    }
</code></pre>
<p>At this stage, we have an editable form.</p>
<h1 id="page_Adding+the+persistent+state">Adding the persistent state</h1>
<p>We would like to store the state of our form in the browser's localStorage. &quot;Save&quot; button must save the state, while &quot;Cancel&quot; must return the form to its default state. First of all, lets add these buttons:</p>
<pre><code class="language-javascript">    render(){
        ...
        return (
            &lt;form onSubmit={ this.onSubmit }&gt;
                ...
                &lt;button type=&quot;submit&quot;&gt;Save&lt;/button&gt;
                &lt;button type=&quot;button&quot; onClick={ this.onCancel }&gt;
                    Clear
                &lt;/button&gt;
            &lt;/form&gt;
        );
    }
</code></pre>
<p>We want &quot;Cancel&quot; button to set out state to its defaults, which is represented in the code quite literally:</p>
<pre><code class="language-javascript">    onCancel = () =&gt; this.state.set( this.state.defaults() );
</code></pre>
<p>And the &quot;Save&quot; button must save the state to the localStorage. Good news is that <em>all the state in React-MVx is serializable by default</em>.</p>
<pre><code class="language-javascript">    onSubmit = () =&gt; localStorage.setItem( 'users-form', JSON.stringify( this.state ) );
</code></pre>
<p>Now, all we have to do is to restore the state on load. Which is done in the standard React's <code>componentWillMount</code> lifecycle hook.</p>
<pre><code class="language-javascript">    componentWillMount(){
        const json = JSON.parse( localStorage.getItem( 'users-form' ) || '{}' );
        this.state.set( json, { parse : true } );
    }
</code></pre>
<p>That's really it. Here are the complete <a href="https://github.com/gaperton/react-mvx-examples/blob/master/src/form.jsx" class="external">sources</a> of our example, and here you can see the example <a href="https://gaperton.github.io/react-mvx-examples/dist/form.html" class="external">working</a>.</p>
<h1 id="page_API+used+in+the+example">API used in the example</h1>
<h3 id="page_state+%3D+%7B+attrName+%3A++%2C+...+%7D"><code>static</code> state = { attrName : <code>attrDef</code>, ... }</h3>
<h3 id="page_component.state">component.state</h3>
<p>Local <a href="../Component/Overview.html">component's</a> <a href="../Component/state.html">state</a>.</p>
<h3 id="page_record.set%28+data%2C+options%3F+%29">record.set( data, options? )</h3>
<p>Component's state is actually modeled with the Type-R's <a href="https://volicon.github.io/Type-R/Record/Overview.html" class="external">Record</a>. <a href="https://volicon.github.io/Type-R/Record/Updates_and_transactions.html" class="external">record.set()</a> method is used to bulk update the state, <code>{ parse : true }</code> option means that <code>data</code> is the raw JSON and needs to be processed accordingly.</p>
<h3 id="page_record.toJSON%28%29">record.toJSON()</h3>
<p>This method was implicitly called in <code>JSON.stringify( this.state ) );</code>. There are more details on Type-R serialization in its <a href="https://volicon.github.io/Type-R/API_by_feature/Serialization.html" class="external">docs</a>.</p>
<h3 id="page_component.linkAll%28%29">component.linkAll()</h3>
<p>Method is used to <a href="../Link/Create_the_link.html">create the links</a> for the state attributes. Read more about <a href="../Link/Overview.html">links</a> in docs.</p>
<h3 id="page_link.props">link.props</h3>
<p><a href="../Link/Link_transformations.html">Transforms</a> the link to the controlled component's <code>value</code>/<code>onChange</code> props pair. Read more about data binding in <a href="../Data-bound_controls.html">docs</a>.</p>
    </div>

        <nav>
        <ul class="Pager">
            <li class=Pager--prev><a href="../Getting_Started.html">Previous</a></li>            <li class=Pager--next><a href="../Guides/Input_Validation.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    
    <!-- jQuery -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script>

    <!-- hightlight.js -->
    <script src="../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../themes/daux/js/daux.js"></script>

            <!-- Tipue Search -->
        <script type="text/javascript" src="../tipuesearch/tipuesearch.js"></script>

        <script>
            window.onunload = function(){}; // force $(document).ready to be called on back/forward navigation in firefox
            $(function() {
                tipuesearch({
                    'base_url': '../'
                });
            });
        </script>
    
</body>
</html>
